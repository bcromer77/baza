const express = require('express');
const router = express.Router();
const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);

router.get('/connect', async (req, res) => {
  const { userId } = req.query;

  try {
    // Create a new Express Stripe account
    const account = await stripe.accounts.create({
      type: 'express',
      metadata: { userId },
    });

    // Generate a Stripe onboarding link
    const accountLink = await stripe.accountLinks.create({
      account: account.id,
      refresh_url: 'https://audiantix.com/join',
      return_url: 'https://audiantix.com/creator-studio',
      type: 'account_onboarding',
    });

    // Redirect user to Stripe onboarding
    res.redirect(accountLink.url);
  } catch (err) {
    console.error('Stripe connect error:', err.message);
    res.status(500).json({ success: false, error: err.message });
  }
});

module.exports = router;

